<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue3新特性 | ALeeLee 的博客 ｜ ALeeLee Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/vueblog/favicon.ico">
    <meta name="description" content="个人博客，前端开发">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/vueblog/assets/css/0.styles.13617540.css" as="style"><link rel="preload" href="/vueblog/assets/js/app.a47bbf5f.js" as="script"><link rel="preload" href="/vueblog/assets/js/8.890bf07c.js" as="script"><link rel="preload" href="/vueblog/assets/js/41.4409705d.js" as="script"><link rel="prefetch" href="/vueblog/assets/js/10.7ddaab85.js"><link rel="prefetch" href="/vueblog/assets/js/11.6998825f.js"><link rel="prefetch" href="/vueblog/assets/js/12.94aa74d4.js"><link rel="prefetch" href="/vueblog/assets/js/13.d43cd65d.js"><link rel="prefetch" href="/vueblog/assets/js/14.efc90eb1.js"><link rel="prefetch" href="/vueblog/assets/js/15.eadc1f16.js"><link rel="prefetch" href="/vueblog/assets/js/16.64c038c7.js"><link rel="prefetch" href="/vueblog/assets/js/17.9a8ae595.js"><link rel="prefetch" href="/vueblog/assets/js/18.0a830cbf.js"><link rel="prefetch" href="/vueblog/assets/js/19.02c02521.js"><link rel="prefetch" href="/vueblog/assets/js/2.d2666a5a.js"><link rel="prefetch" href="/vueblog/assets/js/20.d9e89784.js"><link rel="prefetch" href="/vueblog/assets/js/21.a8ac0e0a.js"><link rel="prefetch" href="/vueblog/assets/js/22.aa305de3.js"><link rel="prefetch" href="/vueblog/assets/js/23.ce4df85d.js"><link rel="prefetch" href="/vueblog/assets/js/24.19dc2cf1.js"><link rel="prefetch" href="/vueblog/assets/js/25.f19caa36.js"><link rel="prefetch" href="/vueblog/assets/js/26.140b560c.js"><link rel="prefetch" href="/vueblog/assets/js/27.b1622df7.js"><link rel="prefetch" href="/vueblog/assets/js/28.8d489edd.js"><link rel="prefetch" href="/vueblog/assets/js/29.2de29f7e.js"><link rel="prefetch" href="/vueblog/assets/js/3.db55bc90.js"><link rel="prefetch" href="/vueblog/assets/js/30.e270c74c.js"><link rel="prefetch" href="/vueblog/assets/js/31.785885c8.js"><link rel="prefetch" href="/vueblog/assets/js/32.8f480b2c.js"><link rel="prefetch" href="/vueblog/assets/js/33.22c3419d.js"><link rel="prefetch" href="/vueblog/assets/js/34.7e7345ae.js"><link rel="prefetch" href="/vueblog/assets/js/35.9900f0e4.js"><link rel="prefetch" href="/vueblog/assets/js/36.f3cc2411.js"><link rel="prefetch" href="/vueblog/assets/js/37.d176f795.js"><link rel="prefetch" href="/vueblog/assets/js/38.719854e6.js"><link rel="prefetch" href="/vueblog/assets/js/39.48f68907.js"><link rel="prefetch" href="/vueblog/assets/js/4.d3fde6e7.js"><link rel="prefetch" href="/vueblog/assets/js/40.7cd3c6e3.js"><link rel="prefetch" href="/vueblog/assets/js/42.9ae29393.js"><link rel="prefetch" href="/vueblog/assets/js/43.b804381e.js"><link rel="prefetch" href="/vueblog/assets/js/44.176898f8.js"><link rel="prefetch" href="/vueblog/assets/js/45.e3453156.js"><link rel="prefetch" href="/vueblog/assets/js/46.35d62772.js"><link rel="prefetch" href="/vueblog/assets/js/47.8d8713a1.js"><link rel="prefetch" href="/vueblog/assets/js/48.37099a30.js"><link rel="prefetch" href="/vueblog/assets/js/49.098f60f0.js"><link rel="prefetch" href="/vueblog/assets/js/5.84d4863f.js"><link rel="prefetch" href="/vueblog/assets/js/6.364979c9.js"><link rel="prefetch" href="/vueblog/assets/js/7.f092bbd1.js"><link rel="prefetch" href="/vueblog/assets/js/9.a82dda5e.js">
    <link rel="stylesheet" href="/vueblog/assets/css/0.styles.13617540.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout" data-v-7f2e4136><header class="header-container" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(./post-bg.jpeg);" data-v-93921ff8 data-v-7f2e4136><nav class="navbar" style="position:absolute;opacity:1;transition:all 0.5s ease-in-out;" data-v-93921ff8><a href="/vueblog/" class="navbar-link router-link-active">
    ALeeLee Blog
  </a> <ul class="navbar-links"><li><a href="/vueblog/" class="router-link-active">
        HOME
      </a></li><li><a href="/vueblog/about/">
        ABOUT
      </a></li><li><a href="/vueblog/tags/">
        TAGS
      </a></li></ul> <div id="nav-icon"><span></span><span></span><span></span></div></nav> <div class="header-title" data-v-93921ff8 data-v-93921ff8><h1 data-v-93921ff8>vue3新特性</h1> <p data-v-93921ff8></p></div></header> <div class="container" data-v-b3fda33c data-v-7f2e4136><main class="main" style="width:60%;" data-v-b3fda33c><div class="post" data-v-b3fda33c data-v-b3fda33c><article class="main-div"><div class="post-content content content__default"><p>vue3新特性</p> <h2 id="_1-vue3-0有什么更新"><a href="#_1-vue3-0有什么更新" class="header-anchor">#</a> 1. Vue3.0有什么更新</h2> <p><strong>（1）监测机制的改变</strong></p> <ul><li>3.0 将带来基于代理 Proxy的 observer 实现，提供全语言覆盖的反应性跟踪。</li> <li>消除了 Vue 2 当中基于 Object.defineProperty 的实现所存在的很多限制：</li></ul> <p><strong>（2）只能监测属性，不能监测对象</strong></p> <ul><li>检测属性的添加和删除；</li> <li>检测数组索引和长度的变更；</li> <li>支持 Map、Set、WeakMap 和 WeakSet。</li></ul> <p><strong>（3）模板</strong></p> <ul><li>作用域插槽，2.x 的机制导致作用域插槽变了，父组件会重新渲染，而 3.0 把作用域插槽改成了函数的方式，这样只会影响子组件的重新渲染，提升了渲染的性能。</li> <li>同时，对于 render 函数的方面，vue3.0 也会进行一系列更改来方便习惯直接使用 api 来生成 vdom 。</li></ul> <p><strong>（4）对象式的组件声明方式</strong></p> <ul><li>vue2.x 中的组件是通过声明的方式传入一系列 option，和 TypeScript 的结合需要通过一些装饰器的方式来做，虽然能实现功能，但是比较麻烦。</li> <li>3.0 修改了组件的声明方式，改成了类式的写法，这样使得和 TypeScript 的结合变得很容易</li></ul> <p><strong>（5）其它方面的更改</strong></p> <ul><li>支持自定义渲染器，从而使得 weex 可以通过自定义渲染器的方式来扩展，而不是直接 fork 源码来改的方式。</li> <li>支持 Fragment（多个根节点）和 Protal（在 dom 其他部分渲染组建内容）组件，针对一些特殊的场景做了处理。</li> <li>基于 tree shaking 优化，提供了更多的内置功能。</li></ul> <h2 id="_2-defineproperty和proxy的区别"><a href="#_2-defineproperty和proxy的区别" class="header-anchor">#</a> 2. defineProperty和proxy的区别</h2> <h3 id="不同点"><a href="#不同点" class="header-anchor">#</a> -----不同点-----</h3> <h3 id="监听方式"><a href="#监听方式" class="header-anchor">#</a> 监听方式</h3> <p><strong>区别一：<code>defineProperty</code> 是对属性劫持，<code>proxy</code> 是对代理对象</strong></p> <p>下面我们针对一个对象使用不同的方式进行监听，看写法上有什么不同</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 原始对象</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">21</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>defineProperty</strong>
defineProperty 只能劫持对象的某一个属性，不能对整个对象进行劫持，如果需要监听某一个对象的所有属性，需要遍历对象的所有属性并对其进行劫持来进行监听</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> oldValue <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用get'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">)</span> <span class="token comment">// 这里为了控制台更明显看出调用，使用了不同颜色进行区分</span>
      <span class="token keyword">return</span> oldValue
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用set'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">)</span>
      oldValue <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Jane</span>
data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jian'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Jian</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre></div><p><strong>proxy</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> proxyData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
 <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用get'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用set'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment">// Reflect通过代理对象更改目标对象的属性值</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'proxyData.name -&gt; '</span><span class="token punctuation">,</span> proxyData<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Jane</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data.name -&gt; '</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Jane</span>
proxyData<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jian'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'proxyData.name -&gt; '</span><span class="token punctuation">,</span> proxyData<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Jian</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data.name -&gt; '</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Jian </span>
</code></pre></div><h3 id="对象新增属性"><a href="#对象新增属性" class="header-anchor">#</a> 对象新增属性</h3> <p>根据他们的监听方式的不同我们就知道，当对象新增属性的时候，defineProperty 没有对新增的属性进行劫持，自然就不会监听到对象新增的属性变化，而proxy 是对对象进行代理，自然就能监听到对象属性的新增。</p> <p><strong>区别二：defineProperty 无法监听对象新增属性，proxy 可以</strong></p> <h3 id="对象删除属性"><a href="#对象删除属性" class="header-anchor">#</a> 对象删除属性</h3> <p><strong>区别三：<code>defineProperty</code> 无法监听对象删除属性，<code>proxy</code> 可以</strong></p> <p>proxy 有专门针对属性删除的方法 deleteProperty，可以在对象属性被删除时触发</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> proxyData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用get'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用set'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用delete'</span><span class="token punctuation">,</span> <span class="token string">'color: red'</span><span class="token punctuation">)</span>
    Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">delete</span> proxyData<span class="token punctuation">.</span>age
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre></div><h3 id="数组的监听"><a href="#数组的监听" class="header-anchor">#</a> 数组的监听</h3> <p><strong>区别四：<code>defineProperty</code> 不能监听数组下标改变值的变化，<code>proxy</code> 可以且不需要对数组的方法进行重载</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 原始数据</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
</code></pre></div><p><strong>如果用defineProperty监听数组</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> oldValue <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用get'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
      <span class="token keyword">return</span> oldValue
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用set'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">)</span>
      oldValue <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment">// 调用set</span>
data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 不调用set</span>
</code></pre></div><p><strong>数组的 key 就是数组的索引</strong>
问题是：数组的 push、pop、shift、unshift、splice、sort，reverse是无法触发 set 方法的
Vue 中能对数组的这些方法监听到是因为 Vue 源码对数组的这些方法进行了重载：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Vue 中对数组方法的重载</span>
<span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'shift'</span><span class="token punctuation">,</span> <span class="token string">'unshift'</span><span class="token punctuation">,</span> <span class="token string">'splice'</span><span class="token punctuation">,</span> <span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token string">'reverse'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> original <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
 Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用数组方法'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span>
     <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment">// 不调用set</span>
data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 调用set</span>
</code></pre></div><p>因此，针对下标方式改变数组的方式是没办法触发 setter 的</p> <p><strong>proxy 监听方式</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> proxyData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
 <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用get'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
   <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用set'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
   <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

proxyData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>
proxyData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="性能"><a href="#性能" class="header-anchor">#</a> 性能</h3> <p><strong>区别五：<code>defineProperty</code> 是循环遍历对象属性的方式来进行监听，自然会比 <code>proxy</code> 对整个对象进行监听的方式要耗性能。</strong></p> <h3 id="相同点"><a href="#相同点" class="header-anchor">#</a> -----相同点-----</h3> <h3 id="共同点：都不支持嵌套"><a href="#共同点：都不支持嵌套" class="header-anchor">#</a> <strong>共同点：都不支持嵌套</strong></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 原始数据</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
  obj<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Jian'</span>
  <span class="token punctuation">}</span>

<span class="token comment">// defineProperty</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> oldValue <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用get'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
      <span class="token keyword">return</span> oldValue
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用set'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">)</span>
      oldValue <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
data<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jian01'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>



<span class="token comment">// proxy</span>
<span class="token keyword">const</span> proxyData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用get'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用set'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c 调用delete'</span><span class="token punctuation">,</span> <span class="token string">'color: red'</span><span class="token punctuation">)</span>
    Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxyData<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
proxyData<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jian02'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxyData<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-vue3-0-为什么要用-proxy？"><a href="#_3-vue3-0-为什么要用-proxy？" class="header-anchor">#</a> 3. Vue3.0 为什么要用 proxy？</h2> <p>在 Vue2 中， 0bject.defineProperty 会改变原始数据，而 Proxy 是创建对象的虚拟表示，并提供 set 、get 和 deleteProperty 等处理器，这些处理器可在访问或修改原始对象上的属性时进行拦截，有以下特点∶</p> <ul><li>不需用使用 <code>Vue.$set</code> 或 <code>Vue.$delete</code> 触发响应式。</li> <li>全方位的数组变化检测，消除了Vue2 无效的边界情况。</li> <li>支持 Map，Set，WeakMap 和 WeakSet。</li></ul> <p>Proxy 实现的响应式原理与 Vue2的实现原理相同，实现方式大同小异∶</p> <ul><li>get 收集依赖</li> <li>Set、delete 等触发依赖</li> <li>对于集合类型，就是对集合对象的方法做一层包装：原方法执行后执行依赖相关的收集或触发逻辑。</li></ul> <h2 id="_4-vue-3-0-中的-vue-composition-api？"><a href="#_4-vue-3-0-中的-vue-composition-api？" class="header-anchor">#</a> 4.  Vue 3.0 中的 Vue Composition API？</h2> <p>在 Vue2 中，代码是 Options API 风格的，也就是通过填充 (option) data、methods、computed 等属性来完成一个 Vue 组件。这种风格使得 Vue 相对于 React极为容易上手，同时也造成了几个问题：</p> <ol><li>由于 Options API 不够灵活的开发方式，使得Vue开发缺乏优雅的方法来在组件间共用代码。</li> <li>Vue 组件过于依赖<code>this</code>上下文，Vue 背后的一些小技巧使得 Vue 组件的开发看起来与 JavaScript 的开发原则相悖，比如在<code>methods</code> 中的<code>this</code>竟然指向组件实例来不指向<code>methods</code>所在的对象。这也使得 TypeScript 在Vue2 中很不好用。</li></ol> <p>于是在 Vue3 中，舍弃了 Options API，转而投向 Composition API。Composition API本质上是将 Options API 背后的机制暴露给用户直接使用，这样用户就拥有了更多的灵活性，也使得 Vue3 更适合于 TypeScript 结合。</p> <p>如下，是一个使用了 Vue Composition API 的 Vue3 组件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;increment&quot;</span><span class="token operator">&gt;</span>
    Count<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token comment">// Composition API 将组件属性暴露为函数，因此第一步是导入所需的函数</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 使用 ref 函数声明了称为 count 的响应属性，对应于Vue2中的data函数</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 
<span class="token comment">// Vue2中需要在methods option中声明的函数，现在直接声明</span>
    <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">.</span>value<span class="token operator">++</span>
    <span class="token punctuation">}</span>
 <span class="token comment">// 对应于Vue2中的mounted声明周期</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'component mounted!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">,</span>
      increment
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
复制代码
</code></pre></div><h2 id="_5-composition-api与react-hook很像，区别是什么"><a href="#_5-composition-api与react-hook很像，区别是什么" class="header-anchor">#</a> 5. Composition API与React Hook很像，区别是什么</h2> <p>显而易见，Vue Composition API 使得 Vue3 的开发风格更接近于原生 JavaScript，带给开发者更多地灵活性</p> <ul><li>前者 reactive + ref 比后者 useState 要难理解</li> <li>前者 setup 只会被调用一次，而后者函数会被多次调用</li> <li>前者无需 useMemo useCallback，因为 setup 只会调用一次</li> <li>前者无需顾虑调用顺序，而后者需要保证 hooks 的顺序一致</li></ul> <h2 id="_6-vue3-0性能提升主要是通过哪几方面体现的？"><a href="#_6-vue3-0性能提升主要是通过哪几方面体现的？" class="header-anchor">#</a> 6. Vue3.0性能提升主要是通过哪几方面体现的？</h2> <h3 id="编译阶段"><a href="#编译阶段" class="header-anchor">#</a> 编译阶段</h3> <p>回顾<code>Vue2</code>，我们知道每个组件实例都对应一个 <code>watcher</code> 实例，它会在组件渲染的过程中把用到的数据<code>property</code>记录为依赖，当依赖发生改变，触发<code>setter</code>，则会通知<code>watcher</code>，从而使关联的组件重新渲染.</p> <p>试想一下，一个组件结构如下图</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>静态文本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>静态文本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>静态文本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>静态文本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>可以看到，组件内部只有一个动态节点，剩余一堆都是静态节点，所以这里很多 <code>diff</code> 和遍历其实都是不需要的，造成性能浪费</p> <p>因此，<code>Vue3</code>在编译阶段，做了进一步优化。主要有如下：</p> <ul><li>diff算法优化</li> <li>静态提升</li> <li>事件监听缓存</li> <li>SSR优化</li></ul> <h3 id="diff算法优化"><a href="#diff算法优化" class="header-anchor">#</a> diff算法优化</h3> <p><code>vue3</code>在<code>diff</code>算法中相比<code>vue2</code>增加了静态标记</p> <p>关于这个静态标记，其作用是为了会发生变化的地方添加一个<code>flag</code>标记，下次发生变化的时候直接找该地方进行比较</p> <p>下图这里，已经标记静态节点的<code>p</code>标签在<code>diff</code>过程中则不会比较，把性能进一步提高</p> <p>关于静态类型枚举如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> PatchFlags <span class="token punctuation">{</span>
  <span class="token constant">TEXT</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 动态的文本节点</span>
  <span class="token constant">CLASS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 2 动态的 class</span>
  <span class="token constant">STYLE</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// 4 动态的 style</span>
  <span class="token constant">PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">// 8 动态属性，不包括类名和样式</span>
  <span class="token constant">FULL_PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token comment">// 16 动态 key，当 key 变化时需要完整的 diff 算法做比较</span>
  <span class="token constant">HYDRATE_EVENTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token comment">// 32 表示带有事件监听器的节点</span>
  <span class="token constant">STABLE_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span>   <span class="token comment">// 64 一个不会改变子节点顺序的 Fragment</span>
  <span class="token constant">KEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// 128 带有 key 属性的 Fragment</span>
  <span class="token constant">UNKEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// 256 子节点没有 key 的 Fragment</span>
  <span class="token constant">NEED_PATCH</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">,</span>   <span class="token comment">// 512</span>
  <span class="token constant">DYNAMIC_SLOTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token comment">// 动态 solt</span>
  <span class="token constant">HOISTED</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 特殊标志是负整数表示永远不会用作 diff</span>
  <span class="token constant">BAIL</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token comment">// 一个特殊的标志，指代差异算法</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="静态提升"><a href="#静态提升" class="header-anchor">#</a> 静态提升</h3> <p><code>Vue3</code>中对不参与更新的元素，会做静态提升，只会被创建一次，在渲染时直接复用</p> <p>这样就免去了重复的创建节点，大型应用会受益于这个改动，免去了重复的创建操作，优化了运行时候的内存占用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>你好<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> message <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>没有做静态提升之前</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span>_Fragment<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span> <span class="token comment">/* STABLE_FRAGMENT */</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>做了静态提升之后</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED */</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span>_Fragment<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    _hoisted_1<span class="token punctuation">,</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span> <span class="token comment">/* STABLE_FRAGMENT */</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Check the console for the AST</span>
</code></pre></div><p>静态内容<code>_hoisted_1</code>被放置在<code>render</code> 函数外，每次渲染的时候只要取 <code>_hoisted_1</code> 即可</p> <p>同时 <code>_hoisted_1</code> 被打上了 <code>PatchFlag</code> ，静态标记值为 -1 ，特殊标志是负整数表示永远不会用于 Diff</p> <h3 id="事件监听缓存"><a href="#事件监听缓存" class="header-anchor">#</a> 事件监听缓存</h3> <p>默认情况下绑定事件行为会被视为动态绑定，所以每次都会去追踪它的变化</p> <div class="language-text extra-class"><pre class="language-text"><code>&lt;div&gt;
  &lt;button @click = 'onClick'&gt;点我&lt;/button&gt;
&lt;/div&gt;
</code></pre></div><p>没开启事件监听器缓存</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_withId</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> onClick<span class="token operator">:</span> _ctx<span class="token punctuation">.</span>onClick <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;点我&quot;</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token comment">/* PROPS */</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;onClick&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                                             <span class="token comment">// PROPS=1&lt;&lt;3,// 8 //动态属性，但不包含类名和样式</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>开启事件侦听器缓存后</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      onClick<span class="token operator">:</span> _cache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_cache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;点我&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述发现开启了缓存后，没有了静态标记。也就是说下次<code>diff</code>算法的时候直接使用</p> <h3 id="ssr优化"><a href="#ssr优化" class="header-anchor">#</a> SSR优化</h3> <p>当静态内容大到一定量级时候，会用<code>createStaticVNode</code>方法在客户端去生成一个static node，这些静态<code>node</code>，会被直接<code>innerHtml</code>，就不需要创建对象，然后根据对象渲染</p> <div class="language-js extra-class"><pre class="language-js"><code>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>你好<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token operator">...</span>  <span class="token comment">// 很多个静态属性</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> message <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>编译后</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mergeProps <span class="token keyword">as</span> _mergeProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ssrRenderAttrs <span class="token keyword">as</span> _ssrRenderAttrs<span class="token punctuation">,</span> ssrInterpolate <span class="token keyword">as</span> _ssrInterpolate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/server-renderer&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ssrRender</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _push<span class="token punctuation">,</span> _parent<span class="token punctuation">,</span> _attrs<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _cssVars <span class="token operator">=</span> <span class="token punctuation">{</span> style<span class="token operator">:</span> <span class="token punctuation">{</span> color<span class="token operator">:</span> _ctx<span class="token punctuation">.</span>color <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token function">_push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
    <span class="token function">_ssrRenderAttrs</span><span class="token punctuation">(</span><span class="token function">_mergeProps</span><span class="token punctuation">(</span>_attrs<span class="token punctuation">,</span> _cssVars<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;div&gt;&lt;span&gt;你好&lt;/span&gt;...&lt;div&gt;&lt;span&gt;你好&lt;/span&gt;&lt;div&gt;&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
    <span class="token function">_ssrInterpolate</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-vue-3-0中treeshaking特性"><a href="#_7-vue-3-0中treeshaking特性" class="header-anchor">#</a> 7. Vue 3.0中Treeshaking特性</h2> <p>通过<code>Tree shaking</code>，<code>Vue3</code>给我们带来的好处是：</p> <ul><li>减少程序体积（更小）</li> <li>减少程序执行时间（更快）</li> <li>便于将来对程序架构进行优化（更友好）</li></ul> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p><code>Tree shaking</code> 是一种通过清除多余代码方式来优化项目打包体积的技术，专业术语叫 <code>Dead code elimination</code></p> <p>简单来讲，就是在保持代码运行结果不变的前提下，去除无用的代码</p> <p>如果把代码打包比作制作蛋糕，传统的方式是把鸡蛋（带壳）全部丢进去搅拌，然后放入烤箱，最后把（没有用的）蛋壳全部挑选并剔除出去</p> <p>而<code>treeshaking</code>则是一开始就把有用的蛋白蛋黄（import）放入搅拌，最后直接作出蛋糕</p> <p>也就是说 ，<code>tree shaking</code> 其实是找出使用的代码</p> <p>在<code>Vue2</code>中，无论我们使用什么功能，它们最终都会出现在生产代码中。主要原因是<code>Vue</code>实例在项目中是单例的，捆绑程序无法检测到该对象的哪些属性在代码中被使用到</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
 
Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>而<code>Vue3</code>源码引入<code>tree shaking</code>特性，将全局 API 进行分块。如果您不使用其某些功能，它们将不会包含在您的基础包中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> nextTick<span class="token punctuation">,</span> observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
 
<span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <p><code>Tree shaking</code>是基于<code>ES6</code>模板语法（<code>import</code>与<code>exports</code>），主要是借助<code>ES6</code>模块的静态编译思想，在编译时就能确定模块的依赖关系，以及输入和输出的变量</p> <p><code>Tree shaking</code>无非就是做了两件事：</p> <ul><li>编译阶段利用<code>ES6 Module</code>判断哪些模块已经加载</li> <li>判断那些模块和变量未被使用或者引用，进而删除对应代码</li></ul> <h3 id="vue2-项目"><a href="#vue2-项目" class="header-anchor">#</a> Vue2 项目</h3> <p>组件中使用<code>data</code>属性</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对项目进行打包，体积如下图</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">DONE</span> Compiled successfully <span class="token keyword">in</span> <span class="token number">18393</span>ms
File                              Size              Gzipped
dist\js\chunk<span class="token operator">-</span>vendors<span class="token punctuation">.</span><span class="token number">28</span>d0d835<span class="token punctuation">.</span>js <span class="token number">89.59</span>KiB          <span class="token number">32.11</span>KiB
dist\js\app<span class="token punctuation">.</span><span class="token number">3</span>f482fc1<span class="token punctuation">.</span>js           <span class="token number">2.01</span> KiB          <span class="token number">1.01</span> KiB
Images and other types <span class="token keyword">of</span> assets omitted<span class="token punctuation">.</span>
</code></pre></div><p>为组件设置其他属性（<code>compted</code>、<code>watch</code>）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        question<span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
        count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    computed<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">double</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    watch<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">question</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newQuestion<span class="token punctuation">,</span> oldQuestion</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>answer <span class="token operator">=</span> <span class="token string">'xxxx'</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>再一次打包，发现打包出来的体积并没有变化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">DONE</span> Compiled successfully <span class="token keyword">in</span> <span class="token number">18393</span>ms
File                              Size              Gzipped
dist\js\chunk<span class="token operator">-</span>vendors<span class="token punctuation">.</span><span class="token number">28</span>d0d835<span class="token punctuation">.</span>js <span class="token number">89.59</span>KiB          <span class="token number">32.11</span>KiB
dist\js\app<span class="token punctuation">.</span><span class="token number">3</span>f482fc1<span class="token punctuation">.</span>js           <span class="token number">2.07</span> KiB          <span class="token number">1.04</span> KiB
Images and other types <span class="token keyword">of</span> assets omitted<span class="token punctuation">.</span>
</code></pre></div><h3 id="vue3-项目"><a href="#vue3-项目" class="header-anchor">#</a> Vue3 项目</h3> <p>组件中简单使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>将项目进行打包</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">DONE</span> Compiled successfully <span class="token keyword">in</span> <span class="token number">18393</span>ms
File                              Size              Gzipped
dist\js\chunk<span class="token operator">-</span>vendors<span class="token punctuation">.</span><span class="token number">28</span>d0d835<span class="token punctuation">.</span>js <span class="token number">78.91</span>KiB          <span class="token number">29.62</span>KiB
dist\js\app<span class="token punctuation">.</span><span class="token number">3</span>f482fc1<span class="token punctuation">.</span>js           <span class="token number">1.92</span> KiB           <span class="token number">0.93</span>KiB
Images and other types <span class="token keyword">of</span> assets omitted<span class="token punctuation">.</span>
</code></pre></div><p>在组件中引入<code>computed</code>和<code>watch</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> defineComponent<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">watch</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> preCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>preCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">,</span>
      double<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>再次对项目进行打包，可以看到在引入<code>computer</code>和<code>watch</code>之后，项目整体体积变大了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">DONE</span> Compiled successfully <span class="token keyword">in</span> <span class="token number">18393</span>ms
File                              Size              Gzipped
dist\js\chunk<span class="token operator">-</span>vendors<span class="token punctuation">.</span><span class="token number">28</span>d0d835<span class="token punctuation">.</span>js <span class="token number">79.85</span>KiB          <span class="token number">29.64</span>KiB
dist\js\app<span class="token punctuation">.</span><span class="token number">3</span>f482fc1<span class="token punctuation">.</span>js           <span class="token number">2.15</span> KiB          <span class="token number">1.00</span> KiB
Images and other types <span class="token keyword">of</span> assets omitted<span class="token punctuation">.</span>
</code></pre></div></div></article> <!----></div></main> <aside class="aside" data-v-b3fda33c data-v-b3fda33c><div class="info-card main-div" data-v-1311ce9e data-v-b3fda33c><div class="info-card-header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(./avatar-bg.jpeg);" data-v-1311ce9e><img src="./avatar-top.jpg" alt="ALeeLee" class="info-avatar" data-v-1311ce9e></div> <div class="info-card-body" data-v-1311ce9e><section class="info-name" data-v-1311ce9e>
      ALeeLee
    </section> <section class="info-desc" data-v-1311ce9e>In me the tiger sniffs the rose<br/>心有猛虎，细嗅蔷薇</section> <section class="info-contact" data-v-1311ce9e><section data-v-1311ce9e><span data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:1em;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-location" data-v-1311ce9e data-v-1311ce9e></use></svg><span class="info-text" data-v-1311ce9e data-v-1311ce9e>
          Chongqing, China
        </span></span></section> <!----> <section data-v-1311ce9e><span data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:1em;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-email" data-v-1311ce9e data-v-1311ce9e></use></svg><span class="info-text" data-v-1311ce9e data-v-1311ce9e>
          992120608@qq.com
        </span></span></section></section></div> <div class="info-card-footer" data-v-1311ce9e><p class="footer-sns-link" data-v-1311ce9e><a target="_blank" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-jianshu" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a><a target="_blank" href="" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-weibo" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a><a target="_blank" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-zhihu" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a><a target="_blank" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-github" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a></p></div></div> <div class="post-toc main-div aside-toc" style="position:relative;top:0;width:0px;" data-v-b3fda33c><h4>- CATALOG</h4> <div class="post-nav-toc"><ul><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#_1-vue3-0有什么更新">1. Vue3.0有什么更新</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#_2-defineproperty和proxy的区别">2. defineProperty和proxy的区别</a><ul><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#不同点">-----不同点-----</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#监听方式">监听方式</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#对象新增属性">对象新增属性</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#对象删除属性">对象删除属性</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#数组的监听">数组的监听</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#性能">性能</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#相同点">-----相同点-----</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#共同点：都不支持嵌套">共同点：都不支持嵌套</a></li></ul></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#_3-vue3-0-为什么要用-proxy？">3. Vue3.0 为什么要用 proxy？</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#_4-vue-3-0-中的-vue-composition-api？">4.  Vue 3.0 中的 Vue Composition API？</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#_5-composition-api与react-hook很像，区别是什么">5. Composition API与React Hook很像，区别是什么</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#_6-vue3-0性能提升主要是通过哪几方面体现的？">6. Vue3.0性能提升主要是通过哪几方面体现的？</a><ul><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#编译阶段">编译阶段</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#diff算法优化">diff算法优化</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#静态提升">静态提升</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#事件监听缓存">事件监听缓存</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#ssr优化">SSR优化</a></li></ul></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#_7-vue-3-0中treeshaking特性">7. Vue 3.0中Treeshaking特性</a><ul><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#原理">原理</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#实现">实现</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#vue2-项目">Vue2 项目</a></li><li><a href="/vueblog/posts/2022/08/07/vue3%E6%96%B0%E7%89%B9%E6%80%A7.html#vue3-项目">Vue3 项目</a></li></ul></li></ul></div></div></aside></div> <footer class="footer" data-v-7f2e4136><p class="footer-sns-link"><a target="_blank" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-jianshu"></use></svg></span></a><a target="_blank" href="" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-weibo"></use></svg></span></a><a target="_blank" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-zhihu"></use></svg></span></a><a target="_blank" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-github"></use></svg></span></a></p> <div class="copyright"><span id="custom">Copyright &copy; ALeeLee Blog 2020 <br /> 
      Theme By <a href="https://www.vuepress.cn/" target="_blank">VuePress</a>
      | <a href="https://www.github.com/youdeliang/" target="_blank">youdeliang</a></span> <iframe frameborder="0" scrolling="0" width="80px" height="20px" class="footer-btn" style="margin-left: 2px; margin-bottom:-5px;"></iframe></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/vueblog/assets/js/app.a47bbf5f.js" defer></script><script src="/vueblog/assets/js/8.890bf07c.js" defer></script><script src="/vueblog/assets/js/41.4409705d.js" defer></script>
  </body>
</html>
